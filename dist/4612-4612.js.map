{"version":3,"file":"4612-4612.js?v=aebb24cec040bc57223b","mappings":"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","sources":["webpack:///nextcloud/node_modules/@nextcloud/dialogs/node_modules/@nextcloud/browser-storage/dist/ScopedStorage.js","webpack:///nextcloud/node_modules/@nextcloud/dialogs/dist/chunks/PublicAuthPrompt-ecDAsnUN.mjs","webpack:///nextcloud/node_modules/@nextcloud/dialogs/node_modules/@nextcloud/browser-storage/dist/index.js","webpack:///nextcloud/node_modules/@nextcloud/dialogs/node_modules/@nextcloud/browser-storage/dist/StorageBuilder.js"],"sourcesContent":["/*\n * SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: GPL-3.0-or-later\n */\nexport default class ScopedStorage {\n    static GLOBAL_SCOPE_VOLATILE = 'nextcloud_vol';\n    static GLOBAL_SCOPE_PERSISTENT = 'nextcloud_per';\n    scope;\n    wrapped;\n    constructor(scope, wrapped, persistent) {\n        this.scope = `${persistent ? ScopedStorage.GLOBAL_SCOPE_PERSISTENT : ScopedStorage.GLOBAL_SCOPE_VOLATILE}_${btoa(scope)}_`;\n        this.wrapped = wrapped;\n    }\n    scopeKey(key) {\n        return `${this.scope}${key}`;\n    }\n    setItem(key, value) {\n        this.wrapped.setItem(this.scopeKey(key), value);\n    }\n    getItem(key) {\n        return this.wrapped.getItem(this.scopeKey(key));\n    }\n    removeItem(key) {\n        this.wrapped.removeItem(this.scopeKey(key));\n    }\n    clear() {\n        Object.keys(this.wrapped)\n            .filter((key) => key.startsWith(this.scope))\n            .map(this.wrapped.removeItem.bind(this.wrapped));\n    }\n}\n","import { defineComponent } from \"vue\";\nimport { getBuilder } from \"@nextcloud/browser-storage\";\nimport { setGuestNickname } from \"@nextcloud/auth\";\nimport { showError } from \"@nextcloud/dialogs\";\nimport NcDialog from \"@nextcloud/vue/components/NcDialog\";\nimport NcNoteCard from \"@nextcloud/vue/components/NcNoteCard\";\nimport NcTextField from \"@nextcloud/vue/components/NcTextField\";\nimport { t, n as normalizeComponent } from \"./_plugin-vue2_normalizer-jrlE7CJU.mjs\";\nimport { validateFilename, InvalidFilenameError, InvalidFilenameErrorReason } from \"@nextcloud/files\";\n/*!\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nfunction getGuestNameValidity(name) {\n  if (name.trim() === \"\") {\n    return t(\"Names must not be empty.\");\n  }\n  if (name.startsWith(\".\")) {\n    return t(\"Names must not start with a dot.\");\n  }\n  if (name.length > 64) {\n    return t(\"Names may be at most 64 characters long.\");\n  }\n  try {\n    validateFilename(name);\n    return \"\";\n  } catch (error) {\n    if (!(error instanceof InvalidFilenameError)) {\n      throw error;\n    }\n    switch (error.reason) {\n      case InvalidFilenameErrorReason.Character:\n        return t('\"{char}\" is not allowed inside a name.', { char: error.segment });\n      case InvalidFilenameErrorReason.ReservedName:\n        return t('\"{segment}\" is a reserved name and not allowed.', { segment: error.segment });\n      case InvalidFilenameErrorReason.Extension:\n        if (error.segment.match(/\\.[a-z]/i)) {\n          return t('\"{extension}\" is not an allowed name.', { extension: error.segment });\n        }\n        return t('Names must not end with \"{extension}\".', { extension: error.segment });\n      default:\n        return t(\"Invalid name.\");\n    }\n  }\n}\nconst storage = getBuilder(\"public\").build();\nconst _sfc_main = defineComponent({\n  name: \"PublicAuthPrompt\",\n  components: {\n    NcDialog,\n    NcNoteCard,\n    NcTextField\n  },\n  props: {\n    /**\n     * Preselected nickname\n     * @default '' No name preselected by default\n     */\n    nickname: {\n      type: String,\n      default: \"\"\n    },\n    /**\n     * Dialog title\n     */\n    title: {\n      type: String,\n      default: t(\"Guest identification\")\n    },\n    /**\n     * Dialog text under the dialog title\n     * e.g 'Enter your name to access the file'\n     * @default '' Not shown by default\n     */\n    text: {\n      type: String,\n      default: \"\"\n    },\n    /**\n     * Dialog notice\n     * @default 'You are currently not identified.'\n     */\n    notice: {\n      type: String,\n      default: \"\"\n    },\n    /**\n     * Dialog submit button label\n     * @default 'Submit name'\n     */\n    submitLabel: {\n      type: String,\n      default: t(\"Submit name\")\n    },\n    /**\n     * Whether the dialog is cancellable\n     * @default false\n     */\n    cancellable: {\n      type: Boolean,\n      default: false\n    }\n  },\n  setup() {\n    return {\n      t\n    };\n  },\n  emits: [\"close\"],\n  data() {\n    return {\n      name: \"\"\n    };\n  },\n  computed: {\n    dialogButtons() {\n      const cancelButton = {\n        label: t(\"Cancel\"),\n        variant: \"tertiary\",\n        callback: () => this.$emit(\"close\")\n      };\n      const submitButton = {\n        label: this.submitLabel,\n        type: \"submit\",\n        variant: \"primary\"\n      };\n      if (this.cancellable) {\n        return [cancelButton, submitButton];\n      }\n      return [submitButton];\n    },\n    defaultNotice() {\n      if (this.notice) {\n        return this.notice;\n      }\n      if (this.nickname) {\n        return t(\"You are currently identified as {nickname}.\", { nickname: this.nickname });\n      }\n      return t(\"You are currently not identified.\");\n    }\n  },\n  watch: {\n    /** Reset name to pre-selected nickname (e.g. Talk / Collabora ) */\n    nickname: {\n      handler() {\n        this.name = this.nickname;\n      },\n      immediate: true\n    },\n    name() {\n      const newName = this.name.trim?.() || \"\";\n      const input = this.$refs.input?.$el.querySelector(\"input\");\n      if (!input) {\n        return;\n      }\n      const validity = getGuestNameValidity(newName);\n      input.setCustomValidity(validity);\n      input.reportValidity();\n    }\n  },\n  methods: {\n    onSubmit() {\n      const input = this.$refs.input;\n      const nickname = this.name.trim();\n      if (nickname === \"\") {\n        input.setCustomValidity(t(\"You cannot leave the name empty.\"));\n        input.reportValidity();\n        input.focus();\n        return;\n      }\n      if (nickname.length < 2) {\n        input.setCustomValidity(t(\"Please enter a name with at least 2 characters.\"));\n        input.reportValidity();\n        input.focus();\n        return;\n      }\n      try {\n        setGuestNickname(nickname);\n      } catch (e) {\n        showError(t(\"Failed to set nickname.\"));\n        console.error(\"Failed to set nickname\", e);\n        input.focus();\n        return;\n      }\n      storage.setItem(\"public-auth-prompt-shown\", \"true\");\n      this.$emit(\"close\", this.name);\n    }\n  }\n});\nvar _sfc_render = function render() {\n  var _vm = this, _c = _vm._self._c;\n  _vm._self._setupProxy;\n  return _c(\"NcDialog\", { staticClass: \"public-auth-prompt\", attrs: { \"buttons\": _vm.dialogButtons, \"data-cy-public-auth-prompt-dialog\": \"\", \"is-form\": \"\", \"no-close\": \"\", \"name\": _vm.title }, on: { \"submit\": _vm.onSubmit } }, [_vm.text ? _c(\"p\", { staticClass: \"public-auth-prompt__text\" }, [_vm._v(\" \" + _vm._s(_vm.text) + \" \")]) : _vm._e(), _c(\"NcNoteCard\", { staticClass: \"public-auth-prompt__header\", attrs: { \"text\": _vm.defaultNotice, \"type\": \"info\" } }), _c(\"NcTextField\", { ref: \"input\", staticClass: \"public-auth-prompt__input\", attrs: { \"data-cy-public-auth-prompt-dialog-name\": \"\", \"label\": _vm.t(\"Name\"), \"placeholder\": _vm.t(\"Enter your name\"), \"required\": !_vm.cancellable, \"minlength\": \"2\", \"maxlength\": \"64\", \"name\": \"name\" }, model: { value: _vm.name, callback: function($$v) {\n    _vm.name = $$v;\n  }, expression: \"name\" } })], 1);\n};\nvar _sfc_staticRenderFns = [];\nvar __component__ = /* @__PURE__ */ normalizeComponent(\n  _sfc_main,\n  _sfc_render,\n  _sfc_staticRenderFns,\n  false,\n  null,\n  \"414f7090\"\n);\nconst PublicAuthPrompt = __component__.exports;\nexport {\n  PublicAuthPrompt as default\n};\n//# sourceMappingURL=PublicAuthPrompt-ecDAsnUN.mjs.map\n","/*\n * SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: GPL-3.0-or-later\n */\nimport ScopedStorage from \"./ScopedStorage.js\";\nimport StorageBuilder from \"./StorageBuilder.js\";\n/**\n * Get the storage builder for an app\n *\n * @param appId App ID to scope storage\n */\nexport function getBuilder(appId) {\n    return new StorageBuilder(appId);\n}\n/**\n * Clear values from storage\n *\n * @param storage The storage to clear\n * @param pred Callback to check if value should be cleared\n */\nfunction clearStorage(storage, pred) {\n    Object.keys(storage)\n        .filter((k) => pred ? pred(k) : true)\n        .map(storage.removeItem.bind(storage));\n}\n/**\n * Clear all values from all storages\n */\nexport function clearAll() {\n    const storages = [\n        window.sessionStorage,\n        window.localStorage,\n    ];\n    storages.map((s) => clearStorage(s));\n}\n/**\n * Clear ony non persistent values\n */\nexport function clearNonPersistent() {\n    const storages = [\n        window.sessionStorage,\n        window.localStorage,\n    ];\n    storages.map((s) => clearStorage(s, (k) => !k.startsWith(ScopedStorage.GLOBAL_SCOPE_PERSISTENT)));\n}\n","/*\n * SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: GPL-3.0-or-later\n */\nimport ScopedStorage from \"./ScopedStorage.js\";\nexport default class StorageBuilder {\n    appId;\n    persisted = false;\n    clearedOnLogout = false;\n    constructor(appId) {\n        this.appId = appId;\n    }\n    persist(persist = true) {\n        this.persisted = persist;\n        return this;\n    }\n    clearOnLogout(clear = true) {\n        this.clearedOnLogout = clear;\n        return this;\n    }\n    build() {\n        return new ScopedStorage(this.appId, this.persisted ? window.localStorage : window.sessionStorage, !this.clearedOnLogout);\n    }\n}\n"],"names":["static","scope","wrapped","constructor","persistent","this","GLOBAL_SCOPE_PERSISTENT","GLOBAL_SCOPE_VOLATILE","btoa","scopeKey","key","setItem","value","getItem","removeItem","clear","Object","keys","filter","startsWith","map","bind","storage","appId","persisted","clearedOnLogout","persist","clearOnLogout","build","window","localStorage","sessionStorage","_sfc_main","name","components","NcDialog","NcNoteCard","NcTextField","props","nickname","type","String","default","title","t","text","notice","submitLabel","cancellable","Boolean","setup","emits","data","computed","dialogButtons","cancelButton","label","variant","callback","$emit","submitButton","defaultNotice","watch","handler","immediate","newName","trim","input","$refs","$el","querySelector","validity","length","error","reason","Character","char","segment","ReservedName","Extension","match","extension","getGuestNameValidity","setCustomValidity","reportValidity","methods","onSubmit","focus","e","console","_sfc_render","_vm","_c","_self","_setupProxy","staticClass","attrs","on","_v","_s","_e","ref","model","$$v","expression","_sfc_staticRenderFns","PublicAuthPrompt","n","exports"],"sourceRoot":""}